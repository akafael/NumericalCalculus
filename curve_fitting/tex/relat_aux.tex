% compilar com lualatex

%% \luaTable{'numDeColunas'}{'nomeArquivo.dat'}{'legenda'}
%% {'linha de Titulo'}

\begin{luacode}
  numC = 3

  function readfileDat(filename)
    local filename = "../data/"..filename

    for line in io.lines(filename) do
        local numl = {}
        for n in string.gmatch(line,"[\%d\%.]+") do
          numl[#numl+1] = tostring(n)
        end
        numC = #numl -- rever esta parte
        tex.sprint(table.concat(numl," & ")," \\\\");
    end
  end
\end{luacode}

\newcommand{\luaTable}[4][\directlua{tex.print(numC)}]
{
  \begin{table}[H]
  \centering
  \caption{#3}
  \begin{tabular}{*{#1}{c}}
  \hline
  #4\\
  \hline
  \directlua{readfileDat('#2')}
  \hline
  \end{tabular}
  \end{table}
}

% Exemplo de uso:
% \luaTable[3]{teste.dat}{legenda}{x&y&z}

\begin{luacode}
  function readEquationTex(vecEq)
    local texEq = {}

    for eq in pairs(vecEq) do
      local texfile = io.open(table.concat({'pol','.tex'},eq),'r')
      texEq = texfile:read("*all")
      tex.sprint(table.concat({eq,texEq},' & ')," \\\\")
    end

    tex.sprint(tableEq)
  end
\end{luacode}

\newcommand{\polyTable}[3][tbPoly]
{
  \begin{table}[H]
    \label{#1}
    \centering
    \caption{#3}
    \begin{tabular}{*{2}{c}}
      \hline
      $i$ & $f_i(x)$\\
      \hline
      \directlua{readEquationTex({#2})}
      \hline
    \end{tabular}
  \end{table}
}

%% Exemplo de uso \eqTable{1,3,5,10}{Polin√¥mios gerados}
